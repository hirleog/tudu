<section style="height: auto">
  <lib-nav>
    <div left-content>
      <a (click)="backToHome()" class="text-decoration-none text-dark">
        <i class="fas fa-arrow-left" style="color: var(--light)"></i>
      </a>
    </div>
    <div central-content>
      <h3 class="title-page m-0" style="color: var(--light)">Orçamentos</h3>
    </div>
    <div right-content>
      <i
        class="fas fa-question-circle"
        style="font-size: 1.5em; color: var(--light)"
        title="Clique para mais informações"
      ></i>
    </div>

    <div
      header-menu
      style="background-color: var(--background) !important"
      class="service-card-header md:hidden flex items-center justify-between p-3 border-b border-gray-200"
    >
      <div class="flex items-center gap-3">
        <div class="icon-style">
          <div>
            <i
              [class]="card?.icon"
              class="text-2xl"
              style="color: var(--light)"
            ></i>
          </div>
        </div>
        <div class="flex flex-col">
          <div class="flex items-center gap-3">
            <div class="service-title truncate w-full">
              <div>
                {{ card?.categoria }}
              </div>
            </div>
          </div>
          <div
            class="whitespace-nowrap overflow-hidden text-ellipsis"
            style="font-size: 12px; color: var(--tab-link)"
          >
            <div>
              <i
                class="fas fa-map-marker-alt text-xs mr-1"
                style="font-size: 12px"
              ></i>
              {{ card?.address?.city }}, {{ card?.address?.state }}
            </div>
          </div>
        </div>
      </div>
    </div>
  </lib-nav>

  <!-- <div id="budgets" class="container" *ngIf="cards?.candidaturas?.length > 0">
    <h4 class="text-start">Meus orçamentos</h4>
  </div> -->

  <div
    id="my-budgets"
    class="container mt-5 pt-5 max-w-4xl mx-auto lg:px-8"
    *ngIf="!paymentStep"
  >
    <div class="row g-3 m-0 p-0">
      <div
        class="col-12 m-0 p-0"
        *ngFor="let candidatura of card?.candidaturas; let i = index"
      >
        <!-- Card de candidatura dentro do lib-card-layout -->
        <lib-card-layout
          [statusPedido]="card.status_pedido"
          [cardTemplateIndicator]="2"
          [hideHeader]="true"
        >
          <!-- HEADER -->
          <div service-icon class="cursor-pointer">
            <i
              [class]="card.icon"
              class="text-2xl"
              style="color: var(--light)"
            ></i>
          </div>

          <div service-title>
            {{ card.categoria }}
          </div>

          <div service-address>
            <i
              class="fas fa-map-marker-alt text-xs mr-1"
              style="font-size: 12px"
            ></i>
            {{ card.address?.city }}, {{ card.address?.state }} -
            {{ card.address?.neighborhood }}
          </div>

          <!-- BODY -->
          <div info-row>
            <div
              class="d-flex"
              style="cursor: pointer"
              (click)="
                goToPrestadorDetail(candidatura.prestador_id, card.id_pedido)
              "
            >
              <div class="request-card-icon">
                <img
                  [src]="
                    !candidatura.prestador_info?.foto
                      ? '../../../assets/img-default.webp'
                      : candidatura.prestador_info?.foto
                  "
                  alt="foto do prestador"
                  class="img-fluid"
                  style="width: 48px; height: 48px; border-radius: 50%"
                />
              </div>

              <div class="ms-2">
                <div class="d-flex align-items-center gap-2">
                  <h5 class="m-0 capitalize">
                    {{ candidatura.prestador_info?.nome }}
                  </h5>
                  <i class="fas fa-star text-warning"></i>
                  <p class="m-0 text-secondary">
                    {{ candidatura.prestador_info?.avaliacao || "—" }}
                  </p>
                </div>
                <p style="color: var(--premium) !important">
                  Prestador Premium
                </p>
              </div>
            </div>

            <div
              class="d-flex justify-content-start align-items-start flex-column gap-2 mt-3"
            >
              <h2 class="fs-4 fw-bold text-truncate">
                {{
                  candidatura.valor_negociado
                    | currency : "BRL" : "symbol" : "1.2-2"
                }}
              </h2>
              <h2 class="fs-6 fw-semibold text-truncate text-gray-600">
                {{
                  candidatura.horario_negociado | date : "dd/MM/yyyy - HH:mm"
                }}
              </h2>
            </div>
          </div>

          <div order-number>#{{ card.id_pedido }}</div>

          <!-- DESCRIPTION (opcional) -->
          <div
            description
            class="text-gray-500 text-sm cursor-pointer"
            (click)="
              goToPrestadorDetail(candidatura.prestador_id, card.id_pedido)
            "
          >
            Clique para ver mais detalhes sobre o prestador.
          </div>

          <!-- FOOTER -->
          <!-- <button
            main-btn
            class="request-quote-btn"
            style="
              color: var(--primary);
              background-color: var(--light) !important;
              border: 1px solid var(--primary);
              width: 100% !important;
            "
            (click)="updateCard(card, 'recusar', candidatura.prestador_id)"
          >
            Recusar
          </button> -->

          <button
            main-btn
            class="request-quote-btn"
            style="
              color: var(--primary);
              background-color: var(--light) !important;
              border: 1px solid var(--primary);
              width: 100% !important;
            "
            (click)="updateCard(card, 'recusar', candidatura.prestador_id)"
          >
            <span *ngIf="!processingBudget" style="color: var(--primary)"
              >Recusar</span
            >
            <span
              *ngIf="processingBudget"
              class="flex items-center justify-center"
              style="color: var(--primary) !important"
            >
              <i
                class="fas fa-circle-notch fa-spin mr-2"
                style="color: var(--primary) !important"
              ></i>
              Aguarde...
            </span>
          </button>

          <button
            price
            class="request-quote-btn"
            style="
              background-color: var(--primary);
              color: white;
              width: 100% !important;
            "
            (click)="goToPayment(card, candidatura.prestador_id)"
          >
            Contratar
          </button>
        </lib-card-layout>
      </div>
    </div>
  </div>

  <div>
    <app-payment
      *ngIf="paymentStep"
      [clientData]="clientData"
      [hiredCardInfo]="hiredCardInfo"
      [hiredCard]="card"
      [selectedCandidatura]="selectedCandidatura"
      (payHiredCard)="payHiredCard($event)"
      (backToOffer)="backToOffer($event)"
    ></app-payment>
  </div>
</section>
<!-- <div *ngIf="card?.candidaturas?.length === 0" class="empty-state-container">
  <div class="empty-state-card shadow-sm rounded-4 p-5">
    <div class="empty-state-icon mb-4">
      <i class="fas fa-file-search" style="font-size: 4rem; color: #6c757d"></i>
    </div>

    <div class="empty-state-content text-center">
      <h3 class="fw-bold mb-3 text-gray-800">
        {{ id_pedido ? "Proposta Indisponível" : "Nenhuma Proposta" }}
      </h3>

      <p class="text-muted mb-4 fs-5">
        {{
          id_pedido
            ? "Esta proposta não está mais disponível ou foi cancelada pelo prestador."
            : "Ainda não há propostas recebidas para seus pedidos."
        }}
      </p>
    </div>
  </div>
</div> -->
<div class="container">
  <lib-fallback-message
    *ngIf="card?.candidaturas?.length === 0"
    [statusPedido]="'indisponivel'"
    (click)="goToHome()"
  >
  </lib-fallback-message>
</div>

<!-- serviço indisponivel ou cancelado -->

<!-- Quando não há propostas: -->
<!-- <app-fallback-message *ngIf="!fallbackMsg" (primaryAction)="goToHome()">
</app-fallback-message> -->

<!-- serviço concluido -->
<!-- <app-fallback-message
  *ngIf="fallbackMsg"
  [statusPedido]="'finalizado'"
  (primaryAction)="goToCardDetail(card)"
>
</app-fallback-message> -->

<!-- Modal  -->
<app-custom-modal #meuModal (click)="closeModal()"></app-custom-modal>

<!-- Conteúdo da página -->
<div class="container mt-5 pt-5"></div>
